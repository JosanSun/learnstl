<!doctype html>
<html lang="zh" class=""><head><meta charset="utf-8"/><title data-react-helmet="true">【游戏框架系列】用C++画光（一）——优化</title><meta name="renderer" content="webkit"/><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="force-rendering" content="webkit"/><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/><meta name="google-site-verification" content="FTeR0c8arOPKh8c5DYh_9uu98_zJbaWw53J-Sch9MTg"/><link rel="shortcut icon" href="https://static.zhihu.com/static/favicon.ico" type="image/x-icon"/><link href="//static.zhihu.com/hemingway/app.72f7034426788143201440249cd536a8.css" rel="stylesheet"/><style></style></head><body><div id="react-root"><div><div class="Layout av-cardBackground" data-zop-userToken="{&quot;userToken&quot;:&quot;&quot;}"><div class="Layout-navbarHolder"><header class="Navbar"><div class="Navbar-logo-wrapper"><a class="Navbar-logo icon-ic_zhihu_logo" href="//www.zhihu.com" target="_blank" rel="noopener noreferrer" aria-label="知乎首页"></a></div><div class="Navbar-postTitle Navbar-title"><a href="https://zhuanlan.zhihu.com/learncpp"><img class="Navbar-columnIcon" alt="学习C++" src="https://pic4.zhimg.com/v2-bf63794c542fc73b11e17014b7e0d01d_m.jpg"/></a><div class="Navbar-postTitleName"><span class="Navbar-postTitleMeta">首发于</span><a class="Navbar-postTitleMain" href="https://zhuanlan.zhihu.com/learncpp">学习C++</a></div></div><div class="Navbar-functionality"><a class="Navbar-write"><i class="icon icon-ic_nav_new"></i>写文章</a><button class="Button Navbar-loginButon Button--blue" type="button">登录</button></div></header></div><div></div><div class="Layout-main av-card av-paddingBottom av-bodyFont Layout-titleImage--normal"><div class="PostIndex-header av-paddingTop av-card" data-zop="{&quot;authorName&quot;:&quot;陈安&quot;,&quot;itemId&quot;:&quot;32150887&quot;,&quot;title&quot;:&quot;【游戏框架系列】用C++画光（一）——优化&quot;,&quot;type&quot;:&quot;article&quot;}"><div class="TitleImage"><img alt="【游戏框架系列】用C++画光（一）——优化" src="https://pic4.zhimg.com/v2-3d70b56d3d5813599b11200f0d877007_r.jpg" class="TitleImage-imagePure"/></div><h1 class="PostIndex-title av-paddingSide av-titleFont">【游戏框架系列】用C++画光（一）——优化</h1><div class="PostIndex-author"><a href="https://www.zhihu.com/people/bajdcc" target="_blank" rel="noopener noreferrer"><img class="Avatar-hemingway PostIndex-authorAvatar Avatar--xs" alt="陈安" src="https://pic1.zhimg.com/v2-cd6d61ad9ef94c41b9e77f8e0f727893_xs.jpg" srcset="https://pic1.zhimg.com/v2-cd6d61ad9ef94c41b9e77f8e0f727893_l.jpg 2x"/></a><a href="https://www.zhihu.com/people/bajdcc" target="_blank" class="PostIndex-authorName">陈安</a><span class="Bull"></span><div class="HoverTitle" data-hover-title="Tue, Dec 19, 2017 2:10 PM"><time datetime="Tue Dec 19 2017 14:10:58 GMT+0800 (CST)">3 days ago</time></div></div></div><div class="RichText PostIndex-content av-paddingSide av-card"><p>(视频：1080P四线程渲染，CPU i7-7700，两图用时约30秒，视频大小0.6M)</p><a class="video-box" href="https://link.zhihu.com/?target=https%3A//www.zhihu.com/video/926906712710057984" target="_blank" data-video-id="" data-video-playable="true" data-name="" data-poster="https://pic1.zhimg.com/80/v2-3fd98ca5da8679918f8b304b4b1f1a84_b.jpg" data-lens-id="926906712710057984">              <img class="thumbnail" src="https://pic1.zhimg.com/80/v2-3fd98ca5da8679918f8b304b4b1f1a84_b.jpg">              <span class="content">                <span class="title"><span class="z-ico-extern-gray"></span><span class="z-ico-extern-blue"></span></span>                <span class="url"><span class="z-ico-video"></span>https://www.zhihu.com/video/926906712710057984</span>              </span>            </a>            <hr><h2>写在前面</h2><p>在先前的画光系列中，实现实体几何、反射、折射等效果，但是最大的一个缺陷是复杂度太高。当采样是1024时，渲染时间直线上升（用4线程），以至好几个小时才能完成一副作品，实现太慢。然而，当我看到<a href="https://zhuanlan.zhihu.com/p/32078689" class="internal">用C++画光（一）</a>这篇文章时，我有了一些思路。</p><p>我想到了<a href="https://zhuanlan.zhihu.com/p/30864679" class="internal">【游戏框架系列】简单的图形学（一）</a>系列文章中的思路，对啊，何必用SDF去慢慢逼近呢？用现成的解析几何算法去做不是更快吗？</p><p>过了一番摸索，终于有了题图。</p><h2>要注意的地方</h2><p>检测圆与直线相交的算法，我从<a href="https://link.zhihu.com/?target=http%3A//www.cnblogs.com/miloyip/archive/2010/03/29/1698953.html" class=" wrap external" target="_blank" rel="nofollow noreferrer">用JavaScript玩转计算机图形学(一)光线追踪入门 - Milo Yip - 博客园<i class="icon-external"></i></a>抄来：</p><div class="highlight"><pre><code class="language-js"><span></span><span class="nx">intersect</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ray</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">ray</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">center</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">a0</span> <span class="o">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">sqrLength</span><span class="p">()</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">sqrRadius</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">DdotV</span> <span class="o">=</span> <span class="nx">ray</span><span class="p">.</span><span class="nx">direction</span><span class="p">.</span><span class="nx">dot</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
 
        <span class="k">if</span> <span class="p">(</span><span class="nx">DdotV</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">discr</span> <span class="o">=</span> <span class="nx">DdotV</span> <span class="o">*</span> <span class="nx">DdotV</span> <span class="o">-</span> <span class="nx">a0</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">discr</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">IntersectResult</span><span class="p">();</span>
                <span class="nx">result</span><span class="p">.</span><span class="nx">geometry</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
                <span class="nx">result</span><span class="p">.</span><span class="nx">distance</span> <span class="o">=</span> <span class="o">-</span><span class="nx">DdotV</span> <span class="o">-</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">discr</span><span class="p">);</span>
                <span class="nx">result</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="nx">ray</span><span class="p">.</span><span class="nx">getPoint</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">distance</span><span class="p">);</span>
                <span class="nx">result</span><span class="p">.</span><span class="nx">normal</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">center</span><span class="p">).</span><span class="nx">normalize</span><span class="p">();</span>
                <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
 
        <span class="k">return</span> <span class="nx">IntersectResult</span><span class="p">.</span><span class="nx">noHit</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div><p>但这里有所不同：3D中的光线追踪是有视角的，也就是说，光线来自同一个点，即摄像机的位置，因此，光线的起点不会在几何图形内部！！<b>而2D中，我们的渲染方式有所不同，光线来自2D区域中的每一个点上，因此，光线起点可能在图形内部</b>。</p><p>所以修改后的代码是这样：</p><div class="highlight"><pre><code class="language-cpp"><span></span><span class="n">Geo2DResult</span> <span class="n">Geo2DCircle</span><span class="o">::</span><span class="n">sample</span><span class="p">(</span><span class="n">vector2</span> <span class="n">ori</span><span class="p">,</span> <span class="n">vector2</span> <span class="n">dir</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="c1">// 圆上点x满足： || 点x - 圆心center || = 圆半径radius</span>
    <span class="c1">// 光线方程 r(t) = o + t.d (t&gt;=0)</span>
    <span class="c1">// 代入得 || o + t.d - c || = r</span>
    <span class="c1">// 令 v = o - c，则 || v + t.d || = r</span>

    <span class="c1">// 化简求 t = - d.v - sqrt( (d.v)^2 + (v^2 - r^2) )  (求最近点)</span>

    <span class="c1">// 令 v = origin - center</span>
    <span class="k">auto</span> <span class="n">v</span> <span class="o">=</span> <span class="n">ori</span> <span class="o">-</span> <span class="n">center</span><span class="p">;</span>

    <span class="c1">// a0 = (v^2 - r^2)</span>
    <span class="k">auto</span> <span class="n">a0</span> <span class="o">=</span> <span class="n">SquareMagnitude</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">-</span> <span class="n">rsq</span><span class="p">;</span>

    <span class="c1">// DdotV = d.v</span>
    <span class="k">auto</span> <span class="n">DdotV</span> <span class="o">=</span> <span class="n">DotProduct</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>

    <span class="c1">//if (DdotV &lt;= 0)</span>
    <span class="p">{</span>
        <span class="c1">// 点乘测试相交，为负则同方向</span>

        <span class="k">auto</span> <span class="n">discr</span> <span class="o">=</span> <span class="p">(</span><span class="n">DdotV</span> <span class="o">*</span> <span class="n">DdotV</span><span class="p">)</span> <span class="o">-</span> <span class="n">a0</span><span class="p">;</span> <span class="c1">// 平方根中的算式</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">discr</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// 非负则方程有解，相交成立</span>
            <span class="c1">// r(t) = o + t.d</span>
            <span class="k">auto</span> <span class="n">distance</span> <span class="o">=</span> <span class="o">-</span><span class="n">DdotV</span> <span class="o">-</span> <span class="n">sqrtf</span><span class="p">(</span><span class="n">discr</span><span class="p">);</span> <span class="c1">// 得出t，即摄影机发出的光线到其与圆的交点距离</span>
            <span class="k">auto</span> <span class="n">distance2</span> <span class="o">=</span> <span class="o">-</span><span class="n">DdotV</span> <span class="o">+</span> <span class="n">sqrtf</span><span class="p">(</span><span class="n">discr</span><span class="p">);</span>
            <span class="k">auto</span> <span class="n">position</span> <span class="o">=</span> <span class="n">ori</span> <span class="o">+</span> <span class="n">dir</span> <span class="o">*</span> <span class="n">distance</span><span class="p">;</span> <span class="c1">// 代入直线方程，得出交点位置</span>
            <span class="k">auto</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">Normalize</span><span class="p">(</span><span class="n">position</span> <span class="o">-</span> <span class="n">center</span><span class="p">);</span> <span class="c1">// 法向量 = 光线终点(球面交点) - 球心坐标</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">a0</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">distance</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span><span class="c1">// 这里不一样！！</span>
                <span class="k">return</span> <span class="n">Geo2DResult</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">a0</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">distance2</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">normal</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">Geo2DResult</span><span class="p">();</span> <span class="c1">// 失败，不相交</span>
<span class="p">}</span>
</code></pre></div><p>相交算法实质上是用参数方程代入求解，得出参数t，其实就是距离。有一种情况是无效的，需要注意，就是<b>当距离为负且光线起点不在图形内部时，这样一种解是无效的，因为我们的线是射线</b>。</p><h2>为什么渲染速度变快了</h2><p>原来的方法是SDF，即不断迭代，最终逼近相交点。这种方法的问题就是迭代的次数太多，每次迭代都进行了同样的计算。</p><p>优化之后，计算相交点，我们直接用解析法，一个方程就能搞定，更棒的是，我们可以求出相交的最近点和最远点（这很重要！）。</p><p>方法的不同影响了渲染时间的多少。</p><h2>怎样安排代码</h2><p><a href="https://link.zhihu.com/?target=https%3A//github.com/bajdcc/GameFramework" class=" wrap external" target="_blank" rel="nofollow noreferrer">bajdcc/GameFramework<i class="icon-external"></i></a></p><p>我们先来看顶层调用（<a href="https://link.zhihu.com/?target=https%3A//github.com/bajdcc/GameFramework/blob/master/CCGameFramework/base/pe2d/Render2DScene2.cpp%23L72" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">github.com/bajdcc/GameF</span><span class="invisible">ramework/blob/master/CCGameFramework/base/pe2d/Render2DScene2.cpp#L72</span><span class="ellipsis"></span><i class="icon-external"></i></a>）：</p><div class="highlight"><pre><code class="language-cpp"><span></span><span class="n">root</span> <span class="o">=</span> <span class="n">Geo2DFactory</span><span class="o">::</span> <span class="n">or</span> <span class="p">(</span>
	<span class="n">Geo2DFactory</span><span class="o">::</span> <span class="n">and</span> <span class="p">(</span>
		<span class="n">Geo2DFactory</span><span class="o">::</span><span class="n">new_circle</span><span class="p">(</span><span class="mf">1.3f</span><span class="p">,</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="mf">0.4f</span><span class="p">,</span> <span class="n">color</span><span class="p">(</span><span class="mf">2.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">)),</span>
		<span class="n">Geo2DFactory</span><span class="o">::</span><span class="n">new_circle</span><span class="p">(</span><span class="mf">1.7f</span><span class="p">,</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="mf">0.4f</span><span class="p">,</span> <span class="n">color</span><span class="p">(</span><span class="mf">2.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">))),</span>
	<span class="n">Geo2DFactory</span><span class="o">::</span> <span class="n">sub</span> <span class="p">(</span>
		<span class="n">Geo2DFactory</span><span class="o">::</span><span class="n">new_circle</span><span class="p">(</span><span class="mf">0.5f</span><span class="p">,</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="mf">0.4f</span><span class="p">,</span> <span class="n">color</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">2.0f</span><span class="p">)),</span>
		<span class="n">Geo2DFactory</span><span class="o">::</span><span class="n">new_circle</span><span class="p">(</span><span class="mf">0.9f</span><span class="p">,</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="mf">0.4f</span><span class="p">,</span> <span class="n">color</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">2.0f</span><span class="p">))));</span>
</code></pre></div><p>结果就是题图，代码定义了两个图形，一个是两圆相交and，一个是两圆sub，两个图形用or串联起来。<br>当然，后面还可以用重载让代码更简洁。</p><p>直线与圆相交算法在<a href="https://link.zhihu.com/?target=https%3A//github.com/bajdcc/GameFramework/blob/master/CCGameFramework/base/pe2d/Geometries2D.cpp%23L163" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">github.com/bajdcc/GameF</span><span class="invisible">ramework/blob/master/CCGameFramework/base/pe2d/Geometries2D.cpp#L163</span><span class="ellipsis"></span><i class="icon-external"></i></a>中，上面已贴过。</p><h2>如何实现两个图形的交、并、差？</h2><p>这里才是本文重点，而实现这功能用了很多时间。</p><p><b>并：</b></p><div class="highlight"><pre><code class="language-cpp"><span></span><span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="n">t_union</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="k">auto</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">obj1</span><span class="o">-&gt;</span><span class="n">sample</span><span class="p">(</span><span class="n">ori</span><span class="p">,</span> <span class="n">dst</span><span class="p">);</span>
    <span class="k">const</span> <span class="k">auto</span> <span class="n">r2</span> <span class="o">=</span> <span class="n">obj2</span><span class="o">-&gt;</span><span class="n">sample</span><span class="p">(</span><span class="n">ori</span><span class="p">,</span> <span class="n">dst</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">r1</span><span class="p">.</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="n">r2</span><span class="p">.</span><span class="n">distance</span> <span class="o">?</span> <span class="nl">r1</span> <span class="p">:</span> <span class="n">r2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>很好解释，直线扫到两个图形上，如果没交点，那么distance就是无穷大，如果有交点，就取距离较近的图形。</p><hr><p><b>交：</b></p><div class="highlight"><pre><code class="language-cpp"><span></span><span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="n">t_intersect</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="k">auto</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">obj1</span><span class="o">-&gt;</span><span class="n">sample</span><span class="p">(</span><span class="n">ori</span><span class="p">,</span> <span class="n">dst</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">r1</span><span class="p">.</span><span class="n">body</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="k">auto</span> <span class="n">r2</span> <span class="o">=</span> <span class="n">obj2</span><span class="o">-&gt;</span><span class="n">sample</span><span class="p">(</span><span class="n">ori</span><span class="p">,</span> <span class="n">dst</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">r2</span><span class="p">.</span><span class="n">body</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">const</span> <span class="k">auto</span> <span class="n">rd</span> <span class="o">=</span> <span class="p">((</span><span class="n">r1</span><span class="p">.</span><span class="n">inside</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">r2</span><span class="p">.</span><span class="n">inside</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
            <span class="k">switch</span> <span class="p">(</span><span class="n">rd</span><span class="p">)</span>
            <span class="p">{</span>
            <span class="k">case</span> <span class="mi">0</span><span class="o">:</span> <span class="c1">// not(A or B)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">r1</span><span class="p">.</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="n">r2</span><span class="p">.</span><span class="n">distance</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">r2</span><span class="p">.</span><span class="n">distance2</span> <span class="o">&gt;</span> <span class="n">r1</span><span class="p">.</span><span class="n">distance</span> <span class="o">&amp;&amp;</span> <span class="n">r2</span><span class="p">.</span><span class="n">distance</span> <span class="o">&gt;</span> <span class="n">r1</span><span class="p">.</span><span class="n">distance2</span><span class="p">)</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">return</span> <span class="n">r2</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">r2</span><span class="p">.</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="n">r1</span><span class="p">.</span><span class="n">distance</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">r1</span><span class="p">.</span><span class="n">distance2</span> <span class="o">&gt;</span> <span class="n">r2</span><span class="p">.</span><span class="n">distance</span> <span class="o">&amp;&amp;</span> <span class="n">r1</span><span class="p">.</span><span class="n">distance</span> <span class="o">&gt;</span> <span class="n">r2</span><span class="p">.</span><span class="n">distance2</span><span class="p">)</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">return</span> <span class="n">r1</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="mi">1</span><span class="o">:</span> <span class="c1">// B</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">r1</span><span class="p">.</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="n">r2</span><span class="p">.</span><span class="n">distance2</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">r1</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="mi">2</span><span class="o">:</span> <span class="c1">// A</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">r2</span><span class="p">.</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="n">r1</span><span class="p">.</span><span class="n">distance2</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">r2</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="mi">3</span><span class="o">:</span> <span class="c1">// A and B</span>
                <span class="k">return</span> <span class="n">r1</span><span class="p">.</span><span class="n">distance</span> <span class="o">&gt;</span> <span class="n">r2</span><span class="p">.</span><span class="n">distance</span> <span class="o">?</span> <span class="nl">r1</span> <span class="p">:</span> <span class="n">r2</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p><i>代码中distance是最近交点（较小根），distance2是最远交点（较大根）。</i></p><p>交就复杂得多，首先，光线必须与两个图形都有交点，其次，分四种情况（我喜欢这样写两个bool的分类讨论。。），讨论光线起点与两个图形的位置关系。</p><p><b>第一</b>，讨论光线起点不在两圆中。</p><p><br></p><figure><noscript><img src="https://pic4.zhimg.com/v2-a8e39207779b638b88597e5aa825fa46_b.jpg" data-size="normal" data-rawwidth="962" data-rawheight="508" class="origin_image zh-lightbox-thumb" width="962" data-original="https://pic4.zhimg.com/v2-a8e39207779b638b88597e5aa825fa46_r.jpg"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='962'%20height='508'&gt;&lt;/svg&gt;" data-size="normal" data-rawwidth="962" data-rawheight="508" class="origin_image zh-lightbox-thumb lazy" width="962" data-original="https://pic4.zhimg.com/v2-a8e39207779b638b88597e5aa825fa46_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-a8e39207779b638b88597e5aa825fa46_b.jpg"><figcaption>交集的情况</figcaption></figure><p>分六种情况(C{2,4}=6)，其中两种情况为不相交，剩下四种情况为相交，代码中就是这个思路。</p><p><b>第二</b>，讨论光线起点在B中，显而易见，交点就是A的边界</p><p><b>第三</b>，讨论光线起点在A中，显而易见，交点就是B的边界</p><p><b>第四</b>，讨论光线起点在A交B中，这里必相交</p><hr><p><b>差：</b></p><div class="highlight"><pre><code class="language-cpp"><span></span><span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="n">t_subtract</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="k">auto</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">obj1</span><span class="o">-&gt;</span><span class="n">sample</span><span class="p">(</span><span class="n">ori</span><span class="p">,</span> <span class="n">dst</span><span class="p">);</span>
    <span class="k">const</span> <span class="k">auto</span> <span class="n">r2</span> <span class="o">=</span> <span class="n">obj2</span><span class="o">-&gt;</span><span class="n">sample</span><span class="p">(</span><span class="n">ori</span><span class="p">,</span> <span class="n">dst</span><span class="p">);</span>
    <span class="k">const</span> <span class="k">auto</span> <span class="n">rd</span> <span class="o">=</span> <span class="p">((</span><span class="n">r1</span><span class="p">.</span><span class="n">body</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">r2</span><span class="p">.</span><span class="n">body</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">rd</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <span class="mi">0</span><span class="o">:</span> <span class="c1">// not(A or B)</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">1</span><span class="o">:</span> <span class="c1">// B</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">2</span><span class="o">:</span> <span class="c1">// A</span>
        <span class="k">return</span> <span class="n">r1</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">3</span><span class="o">:</span> <span class="c1">// A and B</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">r2</span><span class="p">.</span><span class="n">inside</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">r1</span><span class="p">.</span><span class="n">distance2</span> <span class="o">&gt;</span> <span class="n">r2</span><span class="p">.</span><span class="n">distance2</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">auto</span> <span class="n">r</span><span class="p">(</span><span class="n">r2</span><span class="p">);</span>
                <span class="n">r</span><span class="p">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">r1</span><span class="p">.</span><span class="n">body</span><span class="p">;</span>
                <span class="n">r</span><span class="p">.</span><span class="n">inside</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
                <span class="n">r</span><span class="p">.</span><span class="n">distance</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">distance2</span><span class="p">;</span>
                <span class="k">return</span> <span class="n">r</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">r1</span><span class="p">.</span><span class="n">inside</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">r1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">r2</span><span class="p">.</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="n">r1</span><span class="p">.</span><span class="n">distance</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">r1</span><span class="p">.</span><span class="n">distance2</span> <span class="o">&lt;</span> <span class="n">r2</span><span class="p">.</span><span class="n">distance2</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">auto</span> <span class="n">r</span><span class="p">(</span><span class="n">r2</span><span class="p">);</span>
            <span class="n">r</span><span class="p">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">r1</span><span class="p">.</span><span class="n">body</span><span class="p">;</span>
            <span class="n">r</span><span class="p">.</span><span class="n">inside</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
            <span class="n">r</span><span class="p">.</span><span class="n">distance</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">distance2</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">r</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">r1</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>差的实现也不简单，讨论射线与两圆的相交情况：</p><p><b>第一</b>：射线与两圆都不相交，那射线与A-B也不相交</p><p><b>第二</b>：射线与B相交，与A不相交，那射线与A-B也不相交</p><p><b>第三</b>：射线与A相交，与B不相交，射线必定与A-B相交</p><p><b>第四</b>：射线与A交B相交，这时情况复杂了</p><p><br></p><figure><noscript><img src="https://pic3.zhimg.com/v2-ee1d94d97a1d47334211b10db554f916_b.jpg" data-size="normal" data-rawwidth="818" data-rawheight="490" class="origin_image zh-lightbox-thumb" width="818" data-original="https://pic3.zhimg.com/v2-ee1d94d97a1d47334211b10db554f916_r.jpg"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='818'%20height='490'&gt;&lt;/svg&gt;" data-size="normal" data-rawwidth="818" data-rawheight="490" class="origin_image zh-lightbox-thumb lazy" width="818" data-original="https://pic3.zhimg.com/v2-ee1d94d97a1d47334211b10db554f916_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-ee1d94d97a1d47334211b10db554f916_b.jpg"><figcaption>差集的情况</figcaption></figure><p>只考虑两种不相交的情况，如图。反映在代码中就是两个break。<br></p><h2>小结</h2><p>渲染的结果有所不同，发光图形本身的颜色是白色的，这是因为定义时的颜色是RGB(2.0f,1.0f,1.0f)，最终采样经平均后呈现时还是RGB(2.0f,1.0f,1.0f)，做了一个截断之后就是RGB(1.0f,1.0f,1.0f)即白色。</p><p>本文重点即两圆之间的交集、差集的解析法实现，还有直线与圆的相交算法。</p><p>程序下载：<a href="https://link.zhihu.com/?target=https%3A//github.com/bajdcc/GameFramework/releases/tag/v0.2.1" class=" wrap external" target="_blank" rel="nofollow noreferrer">bajdcc/GameFramework<i class="icon-external"></i></a></p></div><div class="PostIndex-footer"><div class="PostIndex-topics TopicItem-wrapper"><a class="TopicItem u-ellipsis PostIndex-topicItem" href="https://www.zhihu.com/topic/19613730">计算机图形学</a><a class="TopicItem u-ellipsis PostIndex-topicItem" href="https://www.zhihu.com/topic/19601705">C / C++</a><a class="TopicItem u-ellipsis PostIndex-topicItem" href="https://www.zhihu.com/topic/19554298">编程</a></div><div class="PostIndex-reviewers"></div><div class="PostIndex-vote"><button class="Button PostIndex-voteButton Button--green" aria-label="赞" type="button"><i class="icon icon-ic_column_like"></i>87</button><div class="PostIndex-voters"><div class="HoverTitle HoverTitle--slim" data-hover-title="HtrhTrhtR"><a href="https://www.zhihu.com/people/llllllscc" class="PostIndex-voter" target="_blank"><img class="Avatar-hemingway Avatar--is" alt="HtrhTrhtR" src="https://pic1.zhimg.com/v2-b81cbfbac8d691b84dba1a95bb8627ca_is.jpg" srcset="https://pic1.zhimg.com/v2-b81cbfbac8d691b84dba1a95bb8627ca_im.jpg 2x"/></a></div><div class="HoverTitle HoverTitle--slim" data-hover-title="DTer"><a href="https://www.zhihu.com/people/ceng-yan-30" class="PostIndex-voter" target="_blank"><img class="Avatar-hemingway Avatar--is" alt="DTer" src="https://pic4.zhimg.com/80664c6e4978d53b8d92ea9b26f70d10_is.jpg" srcset="https://pic4.zhimg.com/80664c6e4978d53b8d92ea9b26f70d10_im.jpg 2x"/></a></div><div class="HoverTitle HoverTitle--slim" data-hover-title="加鲁鲁"><a href="https://www.zhihu.com/people/aiyu-98" class="PostIndex-voter" target="_blank"><img class="Avatar-hemingway Avatar--is" alt="加鲁鲁" src="https://pic3.zhimg.com/v2-9a50b0f90763ec6c56a9e7eb850b1a3d_is.jpg" srcset="https://pic3.zhimg.com/v2-9a50b0f90763ec6c56a9e7eb850b1a3d_im.jpg 2x"/></a></div><div class="HoverTitle HoverTitle--slim" data-hover-title="LGH"><a href="https://www.zhihu.com/people/lgh-6-29" class="PostIndex-voter" target="_blank"><img class="Avatar-hemingway Avatar--is" alt="LGH" src="https://pic1.zhimg.com/v2-51e9fc1f14c1e9c0ef1addcc7942a082_is.jpg" srcset="https://pic1.zhimg.com/v2-51e9fc1f14c1e9c0ef1addcc7942a082_im.jpg 2x"/></a></div><div class="HoverTitle HoverTitle--slim" data-hover-title="半城烟沙king"><a href="https://www.zhihu.com/people/jin-tao-49-39" class="PostIndex-voter" target="_blank"><img class="Avatar-hemingway Avatar--is" alt="半城烟沙king" src="https://pic3.zhimg.com/v2-6404fa0a5980247a4a7378c68c827fa7_is.jpg" srcset="https://pic3.zhimg.com/v2-6404fa0a5980247a4a7378c68c827fa7_im.jpg 2x"/></a></div><a href="/p/32150887/voters" target="_blank" rel="noopener noreferrer" title="查看全部" class="PostIndex-allVoters"><i class="icon-ic_like_more"></i></a></div></div><div class="PostIndex-control"><div class="Fav"><button class="Button Button Button--plain FavButton" type="button"><i class="icon icon-ic_collect"></i>收藏</button></div><div class="PostShare"><div class="Menu"><button class="Button Button Button--plain MenuButton MenuButton-listen-hover Button Button--plain" type="button"><i class="icon icon-ic_column_share"></i>分享</button><div class="Menu-dropdown" style="visibility:hidden;"></div></div></div><div class="Report"><button class="Button Button Button--plain ReportButton" type="button"><i class="icon icon-ic_column_report"></i>举报</button></div></div></div><div class="Contributes PostIndex-contributes av-card"><div class="BlockTitle av-marginLeft av-borderColor"><span class="BlockTitle-title">文章被以下专栏收录</span><span class="BlockTitle-line"></span></div><ul class="Contributes-list"><li style="opacity:1;max-height:300px;" class="Contributes-listItem av-borderColor av-marginLeft"><div class="ContributesItem av-paddingRight" role="link"><a class="ContributesItem-avatar" href="/learncpp"><img class="Avatar-hemingway" src="https://pic4.zhimg.com/v2-bf63794c542fc73b11e17014b7e0d01d_m.jpg" srcset="https://pic4.zhimg.com/v2-bf63794c542fc73b11e17014b7e0d01d_xl.jpg 2x"/></a><div class="ContributesItem-info"><div class="ContributesItem-nameLine"><a class="ContributesItem-name" href="https://zhuanlan.zhihu.com/learncpp">学习C++</a></div><p class="ContributesItem-intro u-ellipsis">写写C++</p></div><a class="ContributesItem-entrance" href="https://zhuanlan.zhihu.com/learncpp">进入专栏</a></div></li></ul></div><div class="PostComment"><div class="BlockTitle av-marginLeft av-borderColor PostComment-blockTitle"><span class="BlockTitle-title">5 条评论</span><span class="BlockTitle-line"></span></div><div class="CommentEditor PostComment-mainEditor"><div class="CommentEditor-input"><div class="CommentEditor-actions"><button class="Button Button--plain" type="button">取消</button><button class="Button Button--blue" disabled="" type="button">评论</button></div></div></div><div class="PostCommentList"></div></div></div></div></div></div><textarea id="clientConfig" hidden="">{&quot;debug&quot;:false,&quot;apiRoot&quot;:&quot;&quot;,&quot;paySDK&quot;:&quot;https:\u002F\u002Fpay.zhihu.com\u002Fapi\u002Fjs&quot;,&quot;wechatConfigAPI&quot;:&quot;\u002Fapi\u002Fwechat\u002Fjssdkconfig&quot;,&quot;name&quot;:&quot;production&quot;,&quot;instance&quot;:&quot;column&quot;,&quot;tokens&quot;:{&quot;X-XSRF-TOKEN&quot;:null,&quot;X-UDID&quot;:null,&quot;Authorization&quot;:&quot;oauth c3cef7c66a1843f8b3a9e6a1e3160e20&quot;}}</textarea><textarea id="preloadedState" hidden="">{&quot;database&quot;:{&quot;Post&quot;:{&quot;32150887&quot;:{&quot;isPending&quot;:false,&quot;contributes&quot;:[{&quot;sourceColumn&quot;:{&quot;lastUpdated&quot;:1497249764,&quot;description&quot;:&quot;玩玩有趣的东西&quot;,&quot;permission&quot;:&quot;COLUMN_PUBLIC&quot;,&quot;memberId&quot;:10760740,&quot;contributePermission&quot;:&quot;COLUMN_PUBLIC&quot;,&quot;translatedCommentPermission&quot;:&quot;all&quot;,&quot;canManage&quot;:true,&quot;intro&quot;:&quot;写写C++&quot;,&quot;urlToken&quot;:&quot;learncpp&quot;,&quot;id&quot;:25963,&quot;imagePath&quot;:&quot;v2-bf63794c542fc73b11e17014b7e0d01d.jpg&quot;,&quot;slug&quot;:&quot;learncpp&quot;,&quot;applyReason&quot;:&quot;0&quot;,&quot;name&quot;:&quot;学习C++&quot;,&quot;title&quot;:&quot;学习C++&quot;,&quot;url&quot;:&quot;https:\u002F\u002Fzhuanlan.zhihu.com\u002Flearncpp&quot;,&quot;commentPermission&quot;:&quot;COLUMN_ALL_CAN_COMMENT&quot;,&quot;canPost&quot;:true,&quot;created&quot;:1483611626,&quot;state&quot;:&quot;COLUMN_NORMAL&quot;,&quot;followers&quot;:3120,&quot;avatar&quot;:{&quot;id&quot;:&quot;v2-bf63794c542fc73b11e17014b7e0d01d&quot;,&quot;template&quot;:&quot;https:\u002F\u002Fpic4.zhimg.com\u002F{id}_{size}.jpg&quot;},&quot;activateAuthorRequested&quot;:false,&quot;following&quot;:false,&quot;imageUrl&quot;:&quot;https:\u002F\u002Fpic4.zhimg.com\u002Fv2-bf63794c542fc73b11e17014b7e0d01d_l.jpg&quot;,&quot;articlesCount&quot;:55},&quot;state&quot;:&quot;accepted&quot;,&quot;targetPost&quot;:{&quot;titleImage&quot;:&quot;https:\u002F\u002Fpic4.zhimg.com\u002Fv2-3d70b56d3d5813599b11200f0d877007_r.jpg&quot;,&quot;lastUpdated&quot;:1513771870,&quot;imagePath&quot;:&quot;v2-3d70b56d3d5813599b11200f0d877007.png&quot;,&quot;permission&quot;:&quot;ARTICLE_PUBLIC&quot;,&quot;topics&quot;:[21222,17215,1354],&quot;summary&quot;:&quot;(视频：1080P四线程渲染，CPU i7-7700，两图用时约30秒，视频大小0.6M)写在前面在先前的画光系列中，实现实体几何、反射、折射等效果，但是最大的一个缺陷是复杂度太高。当采样是1024时，渲染时间直线上升（用4线程），以至好几个小时才能完成一副作品，实…&quot;,&quot;copyPermission&quot;:&quot;ARTICLE_COPYABLE&quot;,&quot;translatedCommentPermission&quot;:&quot;all&quot;,&quot;likes&quot;:0,&quot;origAuthorId&quot;:0,&quot;publishedTime&quot;:&quot;2017-12-19T14:10:58+08:00&quot;,&quot;sourceUrl&quot;:&quot;&quot;,&quot;urlToken&quot;:32150887,&quot;id&quot;:5049547,&quot;withContent&quot;:false,&quot;slug&quot;:32150887,&quot;bigTitleImage&quot;:true,&quot;title&quot;:&quot;【游戏框架系列】用C++画光（一）——优化&quot;,&quot;url&quot;:&quot;\u002Fp\u002F32150887&quot;,&quot;commentPermission&quot;:&quot;ARTICLE_ALL_CAN_COMMENT&quot;,&quot;snapshotUrl&quot;:&quot;&quot;,&quot;created&quot;:1513663858,&quot;comments&quot;:0,&quot;columnId&quot;:0,&quot;content&quot;:&quot;&quot;,&quot;parentId&quot;:0,&quot;state&quot;:&quot;ARTICLE_PUBLISHED&quot;,&quot;imageUrl&quot;:&quot;https:\u002F\u002Fpic4.zhimg.com\u002Fv2-3d70b56d3d5813599b11200f0d877007_r.jpg&quot;,&quot;author&quot;:{&quot;bio&quot;:&quot;专业研究野生技术&quot;,&quot;isFollowing&quot;:false,&quot;hash&quot;:&quot;7a228f3d98a5d011f952110c10dc4976&quot;,&quot;uid&quot;:71809588264960,&quot;isOrg&quot;:false,&quot;slug&quot;:&quot;bajdcc&quot;,&quot;isFollowed&quot;:false,&quot;description&quot;:&quot;发现编程的乐趣 https:\u002F\u002Fgithub.com\u002Fbajdcc&quot;,&quot;name&quot;:&quot;陈安&quot;,&quot;profileUrl&quot;:&quot;https:\u002F\u002Fwww.zhihu.com\u002Fpeople\u002Fbajdcc&quot;,&quot;avatar&quot;:{&quot;id&quot;:&quot;v2-cd6d61ad9ef94c41b9e77f8e0f727893&quot;,&quot;template&quot;:&quot;https:\u002F\u002Fpic1.zhimg.com\u002F{id}_{size}.jpg&quot;},&quot;isOrgWhiteList&quot;:false,&quot;isBanned&quot;:false},&quot;memberId&quot;:10760740,&quot;excerptTitle&quot;:&quot;&quot;,&quot;voteType&quot;:&quot;ARTICLE_VOTE_CLEAR&quot;},&quot;id&quot;:992770}],&quot;title&quot;:&quot;【游戏框架系列】用C++画光（一）——优化&quot;,&quot;author&quot;:&quot;bajdcc&quot;,&quot;content&quot;:&quot;\u003Cp\u003E(视频：1080P四线程渲染，CPU i7-7700，两图用时约30秒，视频大小0.6M)\u003C\u002Fp\u003E\u003Ca class=\&quot;video-box\&quot; href=\&quot;https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fwww.zhihu.com\u002Fvideo\u002F926906712710057984\&quot; target=\&quot;_blank\&quot; data-video-id=\&quot;\&quot; data-video-playable=\&quot;true\&quot; data-name=\&quot;\&quot; data-poster=\&quot;https:\u002F\u002Fpic1.zhimg.com\u002F80\u002Fv2-3fd98ca5da8679918f8b304b4b1f1a84_b.jpg\&quot; data-lens-id=\&quot;926906712710057984\&quot;\u003E              \u003Cimg class=\&quot;thumbnail\&quot; src=\&quot;https:\u002F\u002Fpic1.zhimg.com\u002F80\u002Fv2-3fd98ca5da8679918f8b304b4b1f1a84_b.jpg\&quot;\u003E              \u003Cspan class=\&quot;content\&quot;\u003E                \u003Cspan class=\&quot;title\&quot;\u003E\u003Cspan class=\&quot;z-ico-extern-gray\&quot;\u003E\u003C\u002Fspan\u003E\u003Cspan class=\&quot;z-ico-extern-blue\&quot;\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E                \u003Cspan class=\&quot;url\&quot;\u003E\u003Cspan class=\&quot;z-ico-video\&quot;\u003E\u003C\u002Fspan\u003Ehttps:\u002F\u002Fwww.zhihu.com\u002Fvideo\u002F926906712710057984\u003C\u002Fspan\u003E              \u003C\u002Fspan\u003E            \u003C\u002Fa\u003E            \u003Chr\u003E\u003Ch2\u003E写在前面\u003C\u002Fh2\u003E\u003Cp\u003E在先前的画光系列中，实现实体几何、反射、折射等效果，但是最大的一个缺陷是复杂度太高。当采样是1024时，渲染时间直线上升（用4线程），以至好几个小时才能完成一副作品，实现太慢。然而，当我看到\u003Ca href=\&quot;https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F32078689\&quot; class=\&quot;internal\&quot;\u003E用C++画光（一）\u003C\u002Fa\u003E这篇文章时，我有了一些思路。\u003C\u002Fp\u003E\u003Cp\u003E我想到了\u003Ca href=\&quot;https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F30864679\&quot; class=\&quot;internal\&quot;\u003E【游戏框架系列】简单的图形学（一）\u003C\u002Fa\u003E系列文章中的思路，对啊，何必用SDF去慢慢逼近呢？用现成的解析几何算法去做不是更快吗？\u003C\u002Fp\u003E\u003Cp\u003E过了一番摸索，终于有了题图。\u003C\u002Fp\u003E\u003Ch2\u003E要注意的地方\u003C\u002Fh2\u003E\u003Cp\u003E检测圆与直线相交的算法，我从\u003Ca href=\&quot;https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.cnblogs.com\u002Fmiloyip\u002Farchive\u002F2010\u002F03\u002F29\u002F1698953.html\&quot; class=\&quot; wrap external\&quot; target=\&quot;_blank\&quot; rel=\&quot;nofollow noreferrer\&quot;\u003E用JavaScript玩转计算机图形学(一)光线追踪入门 - Milo Yip - 博客园\u003Ci class=\&quot;icon-external\&quot;\u003E\u003C\u002Fi\u003E\u003C\u002Fa\u003E抄来：\u003C\u002Fp\u003E\u003Cdiv class=\&quot;highlight\&quot;\u003E\u003Cpre\u003E\u003Ccode class=\&quot;language-js\&quot;\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003Eintersect\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\&quot;kd\&quot;\u003Efunction\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003Eray\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;kd\&quot;\u003Evar\u003C\u002Fspan\u003E \u003Cspan class=\&quot;nx\&quot;\u003Ev\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;nx\&quot;\u003Eray\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003Eorigin\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003Esubtract\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;k\&quot;\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003Ecenter\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E);\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;kd\&quot;\u003Evar\u003C\u002Fspan\u003E \u003Cspan class=\&quot;nx\&quot;\u003Ea0\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;nx\&quot;\u003Ev\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003EsqrLength\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\&quot;k\&quot;\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003EsqrRadius\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;kd\&quot;\u003Evar\u003C\u002Fspan\u003E \u003Cspan class=\&quot;nx\&quot;\u003EDdotV\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;nx\&quot;\u003Eray\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003Edirection\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003Edot\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003Ev\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E);\u003C\u002Fspan\u003E\n \n        \u003Cspan class=\&quot;k\&quot;\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003EDdotV\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E&amp;lt;=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mi\&quot;\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E{\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;kd\&quot;\u003Evar\u003C\u002Fspan\u003E \u003Cspan class=\&quot;nx\&quot;\u003Ediscr\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;nx\&quot;\u003EDdotV\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\&quot;nx\&quot;\u003EDdotV\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\&quot;nx\&quot;\u003Ea0\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;k\&quot;\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003Ediscr\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E&amp;gt;=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mi\&quot;\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E{\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;kd\&quot;\u003Evar\u003C\u002Fspan\u003E \u003Cspan class=\&quot;nx\&quot;\u003Eresult\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;k\&quot;\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\&quot;nx\&quot;\u003EIntersectResult\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E();\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;nx\&quot;\u003Eresult\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003Egeometry\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;k\&quot;\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;nx\&quot;\u003Eresult\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003Edistance\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003EDdotV\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\&quot;nb\&quot;\u003EMath\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003Esqrt\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003Ediscr\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E);\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;nx\&quot;\u003Eresult\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003Eposition\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;nx\&quot;\u003Eray\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003EgetPoint\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003Eresult\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003Edistance\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E);\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;nx\&quot;\u003Eresult\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003Enormal\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;nx\&quot;\u003Eresult\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003Eposition\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003Esubtract\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;k\&quot;\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003Ecenter\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E).\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003Enormalize\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E();\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;k\&quot;\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\&quot;nx\&quot;\u003Eresult\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;p\&quot;\u003E}\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;p\&quot;\u003E}\u003C\u002Fspan\u003E\n \n        \u003Cspan class=\&quot;k\&quot;\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\&quot;nx\&quot;\u003EIntersectResult\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;nx\&quot;\u003EnoHit\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;p\&quot;\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E但这里有所不同：3D中的光线追踪是有视角的，也就是说，光线来自同一个点，即摄像机的位置，因此，光线的起点不会在几何图形内部！！\u003Cb\u003E而2D中，我们的渲染方式有所不同，光线来自2D区域中的每一个点上，因此，光线起点可能在图形内部\u003C\u002Fb\u003E。\u003C\u002Fp\u003E\u003Cp\u003E所以修改后的代码是这样：\u003C\u002Fp\u003E\u003Cdiv class=\&quot;highlight\&quot;\u003E\u003Cpre\u003E\u003Ccode class=\&quot;language-cpp\&quot;\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003EGeo2DResult\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003EGeo2DCircle\u003C\u002Fspan\u003E\u003Cspan class=\&quot;o\&quot;\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Esample\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Evector2\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Eori\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Evector2\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Edir\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\&quot;k\&quot;\u003Econst\u003C\u002Fspan\u003E\n\u003Cspan class=\&quot;p\&quot;\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F 圆上点x满足： || 点x - 圆心center || = 圆半径radius\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F 光线方程 r(t) = o + t.d (t&amp;gt;=0)\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F 代入得 || o + t.d - c || = r\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F 令 v = o - c，则 || v + t.d || = r\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F 化简求 t = - d.v - sqrt( (d.v)^2 + (v^2 - r^2) )  (求最近点)\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F 令 v = origin - center\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;k\&quot;\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Ev\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Eori\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Ecenter\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F a0 = (v^2 - r^2)\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;k\&quot;\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Ea0\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003ESquareMagnitude\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Ev\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Ersq\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F DdotV = d.v\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;k\&quot;\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003EDdotV\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003EDotProduct\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edir\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Ev\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E);\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002Fif (DdotV &amp;lt;= 0)\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;p\&quot;\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F 点乘测试相交，为负则同方向\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\&quot;k\&quot;\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Ediscr\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003EDdotV\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003EDdotV\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Ea0\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F 平方根中的算式\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\&quot;k\&quot;\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Ediscr\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E&amp;gt;=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mi\&quot;\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;p\&quot;\u003E{\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F 非负则方程有解，相交成立\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F r(t) = o + t.d\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;k\&quot;\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Edistance\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003EDdotV\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Esqrtf\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Ediscr\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E);\u003C\u002Fspan\u003E \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F 得出t，即摄影机发出的光线到其与圆的交点距离\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;k\&quot;\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Edistance2\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003EDdotV\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Esqrtf\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Ediscr\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E);\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;k\&quot;\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Eposition\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Eori\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Edir\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Edistance\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F 代入直线方程，得出交点位置\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;k\&quot;\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Enormal\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003ENormalize\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Eposition\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Ecenter\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E);\u003C\u002Fspan\u003E \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F 法向量 = 光线终点(球面交点) - 球心坐标\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;k\&quot;\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Ea0\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E&amp;lt;=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mi\&quot;\u003E0\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E||\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Edistance\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E&amp;gt;=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mi\&quot;\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F 这里不一样！！\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;k\&quot;\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003EGeo2DResult\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;k\&quot;\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Ea0\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E&amp;lt;=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mi\&quot;\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Edistance\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Edistance2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Eposition\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Enormal\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E);\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;p\&quot;\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;p\&quot;\u003E}\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\&quot;k\&quot;\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003EGeo2DResult\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E();\u003C\u002Fspan\u003E \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F 失败，不相交\u003C\u002Fspan\u003E\n\u003Cspan class=\&quot;p\&quot;\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E相交算法实质上是用参数方程代入求解，得出参数t，其实就是距离。有一种情况是无效的，需要注意，就是\u003Cb\u003E当距离为负且光线起点不在图形内部时，这样一种解是无效的，因为我们的线是射线\u003C\u002Fb\u003E。\u003C\u002Fp\u003E\u003Ch2\u003E为什么渲染速度变快了\u003C\u002Fh2\u003E\u003Cp\u003E原来的方法是SDF，即不断迭代，最终逼近相交点。这种方法的问题就是迭代的次数太多，每次迭代都进行了同样的计算。\u003C\u002Fp\u003E\u003Cp\u003E优化之后，计算相交点，我们直接用解析法，一个方程就能搞定，更棒的是，我们可以求出相交的最近点和最远点（这很重要！）。\u003C\u002Fp\u003E\u003Cp\u003E方法的不同影响了渲染时间的多少。\u003C\u002Fp\u003E\u003Ch2\u003E怎样安排代码\u003C\u002Fh2\u003E\u003Cp\u003E\u003Ca href=\&quot;https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fgithub.com\u002Fbajdcc\u002FGameFramework\&quot; class=\&quot; wrap external\&quot; target=\&quot;_blank\&quot; rel=\&quot;nofollow noreferrer\&quot;\u003Ebajdcc\u002FGameFramework\u003Ci class=\&quot;icon-external\&quot;\u003E\u003C\u002Fi\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cp\u003E我们先来看顶层调用（\u003Ca href=\&quot;https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fgithub.com\u002Fbajdcc\u002FGameFramework\u002Fblob\u002Fmaster\u002FCCGameFramework\u002Fbase\u002Fpe2d\u002FRender2DScene2.cpp%23L72\&quot; class=\&quot; external\&quot; target=\&quot;_blank\&quot; rel=\&quot;nofollow noreferrer\&quot;\u003E\u003Cspan class=\&quot;invisible\&quot;\u003Ehttps:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\&quot;visible\&quot;\u003Egithub.com\u002Fbajdcc\u002FGameF\u003C\u002Fspan\u003E\u003Cspan class=\&quot;invisible\&quot;\u003Eramework\u002Fblob\u002Fmaster\u002FCCGameFramework\u002Fbase\u002Fpe2d\u002FRender2DScene2.cpp#L72\u003C\u002Fspan\u003E\u003Cspan class=\&quot;ellipsis\&quot;\u003E\u003C\u002Fspan\u003E\u003Ci class=\&quot;icon-external\&quot;\u003E\u003C\u002Fi\u003E\u003C\u002Fa\u003E）：\u003C\u002Fp\u003E\u003Cdiv class=\&quot;highlight\&quot;\u003E\u003Cpre\u003E\u003Ccode class=\&quot;language-cpp\&quot;\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Eroot\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003EGeo2DFactory\u003C\u002Fspan\u003E\u003Cspan class=\&quot;o\&quot;\u003E::\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Eor\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\n\t\u003Cspan class=\&quot;n\&quot;\u003EGeo2DFactory\u003C\u002Fspan\u003E\u003Cspan class=\&quot;o\&quot;\u003E::\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Eand\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\&quot;n\&quot;\u003EGeo2DFactory\u003C\u002Fspan\u003E\u003Cspan class=\&quot;o\&quot;\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Enew_circle\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;mf\&quot;\u003E1.3f\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mf\&quot;\u003E0.5f\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mf\&quot;\u003E0.4f\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Ecolor\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;mf\&quot;\u003E2.0f\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mf\&quot;\u003E1.0f\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mf\&quot;\u003E1.0f\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)),\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\&quot;n\&quot;\u003EGeo2DFactory\u003C\u002Fspan\u003E\u003Cspan class=\&quot;o\&quot;\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Enew_circle\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;mf\&quot;\u003E1.7f\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mf\&quot;\u003E0.5f\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mf\&quot;\u003E0.4f\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Ecolor\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;mf\&quot;\u003E2.0f\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mf\&quot;\u003E1.0f\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mf\&quot;\u003E1.0f\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E))),\u003C\u002Fspan\u003E\n\t\u003Cspan class=\&quot;n\&quot;\u003EGeo2DFactory\u003C\u002Fspan\u003E\u003Cspan class=\&quot;o\&quot;\u003E::\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Esub\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\&quot;n\&quot;\u003EGeo2DFactory\u003C\u002Fspan\u003E\u003Cspan class=\&quot;o\&quot;\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Enew_circle\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;mf\&quot;\u003E0.5f\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mf\&quot;\u003E0.5f\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mf\&quot;\u003E0.4f\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Ecolor\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;mf\&quot;\u003E1.0f\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mf\&quot;\u003E1.0f\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mf\&quot;\u003E2.0f\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)),\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\&quot;n\&quot;\u003EGeo2DFactory\u003C\u002Fspan\u003E\u003Cspan class=\&quot;o\&quot;\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Enew_circle\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;mf\&quot;\u003E0.9f\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mf\&quot;\u003E0.5f\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mf\&quot;\u003E0.4f\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Ecolor\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;mf\&quot;\u003E1.0f\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mf\&quot;\u003E1.0f\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mf\&quot;\u003E2.0f\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E))));\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E结果就是题图，代码定义了两个图形，一个是两圆相交and，一个是两圆sub，两个图形用or串联起来。\u003Cbr\u003E当然，后面还可以用重载让代码更简洁。\u003C\u002Fp\u003E\u003Cp\u003E直线与圆相交算法在\u003Ca href=\&quot;https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fgithub.com\u002Fbajdcc\u002FGameFramework\u002Fblob\u002Fmaster\u002FCCGameFramework\u002Fbase\u002Fpe2d\u002FGeometries2D.cpp%23L163\&quot; class=\&quot; external\&quot; target=\&quot;_blank\&quot; rel=\&quot;nofollow noreferrer\&quot;\u003E\u003Cspan class=\&quot;invisible\&quot;\u003Ehttps:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\&quot;visible\&quot;\u003Egithub.com\u002Fbajdcc\u002FGameF\u003C\u002Fspan\u003E\u003Cspan class=\&quot;invisible\&quot;\u003Eramework\u002Fblob\u002Fmaster\u002FCCGameFramework\u002Fbase\u002Fpe2d\u002FGeometries2D.cpp#L163\u003C\u002Fspan\u003E\u003Cspan class=\&quot;ellipsis\&quot;\u003E\u003C\u002Fspan\u003E\u003Ci class=\&quot;icon-external\&quot;\u003E\u003C\u002Fi\u003E\u003C\u002Fa\u003E中，上面已贴过。\u003C\u002Fp\u003E\u003Ch2\u003E如何实现两个图形的交、并、差？\u003C\u002Fh2\u003E\u003Cp\u003E这里才是本文重点，而实现这功能用了很多时间。\u003C\u002Fp\u003E\u003Cp\u003E\u003Cb\u003E并：\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cdiv class=\&quot;highlight\&quot;\u003E\u003Cpre\u003E\u003Ccode class=\&quot;language-cpp\&quot;\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\&quot;k\&quot;\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Eop\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Et_union\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\&quot;p\&quot;\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;k\&quot;\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\&quot;k\&quot;\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Eobj1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;o\&quot;\u003E-&amp;gt;\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Esample\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Eori\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Edst\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;k\&quot;\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\&quot;k\&quot;\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Eobj2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;o\&quot;\u003E-&amp;gt;\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Esample\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Eori\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Edst\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;k\&quot;\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E&amp;lt;\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E?\u003C\u002Fspan\u003E \u003Cspan class=\&quot;nl\&quot;\u003Er1\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\&quot;p\&quot;\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E很好解释，直线扫到两个图形上，如果没交点，那么distance就是无穷大，如果有交点，就取距离较近的图形。\u003C\u002Fp\u003E\u003Chr\u003E\u003Cp\u003E\u003Cb\u003E交：\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cdiv class=\&quot;highlight\&quot;\u003E\u003Cpre\u003E\u003Ccode class=\&quot;language-cpp\&quot;\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\&quot;k\&quot;\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Eop\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Et_intersect\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\&quot;p\&quot;\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;k\&quot;\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\&quot;k\&quot;\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Eobj1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;o\&quot;\u003E-&amp;gt;\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Esample\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Eori\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Edst\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;k\&quot;\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Ebody\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;p\&quot;\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;k\&quot;\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\&quot;k\&quot;\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Eobj2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;o\&quot;\u003E-&amp;gt;\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Esample\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Eori\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Edst\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E);\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;k\&quot;\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Ebody\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;p\&quot;\u003E{\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;k\&quot;\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\&quot;k\&quot;\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Erd\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E((\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Einside\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E?\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mi\&quot;\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mi\&quot;\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E&amp;lt;&amp;lt;\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mi\&quot;\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E|\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Einside\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E?\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mi\&quot;\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mi\&quot;\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E);\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;k\&quot;\u003Eswitch\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Erd\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;p\&quot;\u003E{\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;k\&quot;\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mi\&quot;\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\&quot;o\&quot;\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F not(A or B)\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;k\&quot;\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E&amp;lt;\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;p\&quot;\u003E{\u003C\u002Fspan\u003E\n                    \u003Cspan class=\&quot;k\&quot;\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance2\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E&amp;gt;\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E&amp;amp;&amp;amp;\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E&amp;gt;\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E\n                        \u003Cspan class=\&quot;k\&quot;\u003Ebreak\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n                    \u003Cspan class=\&quot;k\&quot;\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;p\&quot;\u003E}\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;k\&quot;\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E&amp;lt;\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;p\&quot;\u003E{\u003C\u002Fspan\u003E\n                    \u003Cspan class=\&quot;k\&quot;\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance2\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E&amp;gt;\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E&amp;amp;&amp;amp;\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E&amp;gt;\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E\n                        \u003Cspan class=\&quot;k\&quot;\u003Ebreak\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n                    \u003Cspan class=\&quot;k\&quot;\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;p\&quot;\u003E}\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;k\&quot;\u003Ebreak\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;k\&quot;\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mi\&quot;\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;o\&quot;\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F B\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;k\&quot;\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E&amp;lt;\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E\n                    \u003Cspan class=\&quot;k\&quot;\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;k\&quot;\u003Ebreak\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;k\&quot;\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mi\&quot;\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;o\&quot;\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F A\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;k\&quot;\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E&amp;lt;\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E\n                    \u003Cspan class=\&quot;k\&quot;\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;k\&quot;\u003Ebreak\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;k\&quot;\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mi\&quot;\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\&quot;o\&quot;\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F A and B\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;k\&quot;\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E&amp;gt;\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E?\u003C\u002Fspan\u003E \u003Cspan class=\&quot;nl\&quot;\u003Er1\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;k\&quot;\u003Edefault\u003C\u002Fspan\u003E\u003Cspan class=\&quot;o\&quot;\u003E:\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;k\&quot;\u003Ebreak\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;p\&quot;\u003E}\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;p\&quot;\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;p\&quot;\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\&quot;p\&quot;\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E\u003Ci\u003E代码中distance是最近交点（较小根），distance2是最远交点（较大根）。\u003C\u002Fi\u003E\u003C\u002Fp\u003E\u003Cp\u003E交就复杂得多，首先，光线必须与两个图形都有交点，其次，分四种情况（我喜欢这样写两个bool的分类讨论。。），讨论光线起点与两个图形的位置关系。\u003C\u002Fp\u003E\u003Cp\u003E\u003Cb\u003E第一\u003C\u002Fb\u003E，讨论光线起点不在两圆中。\u003C\u002Fp\u003E\u003Cp\u003E\u003Cbr\u003E\u003C\u002Fp\u003E\u003Cfigure\u003E\u003Cnoscript\u003E\u003Cimg src=\&quot;https:\u002F\u002Fpic4.zhimg.com\u002Fv2-a8e39207779b638b88597e5aa825fa46_b.jpg\&quot; data-size=\&quot;normal\&quot; data-rawwidth=\&quot;962\&quot; data-rawheight=\&quot;508\&quot; class=\&quot;origin_image zh-lightbox-thumb\&quot; width=\&quot;962\&quot; data-original=\&quot;https:\u002F\u002Fpic4.zhimg.com\u002Fv2-a8e39207779b638b88597e5aa825fa46_r.jpg\&quot;\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\&quot;data:image\u002Fsvg+xml;utf8,&amp;lt;svg%20xmlns=&#x27;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#x27;%20width=&#x27;962&#x27;%20height=&#x27;508&#x27;&amp;gt;&amp;lt;\u002Fsvg&amp;gt;\&quot; data-size=\&quot;normal\&quot; data-rawwidth=\&quot;962\&quot; data-rawheight=\&quot;508\&quot; class=\&quot;origin_image zh-lightbox-thumb lazy\&quot; width=\&quot;962\&quot; data-original=\&quot;https:\u002F\u002Fpic4.zhimg.com\u002Fv2-a8e39207779b638b88597e5aa825fa46_r.jpg\&quot; data-actualsrc=\&quot;https:\u002F\u002Fpic4.zhimg.com\u002Fv2-a8e39207779b638b88597e5aa825fa46_b.jpg\&quot;\u003E\u003Cfigcaption\u003E交集的情况\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E分六种情况(C{2,4}=6)，其中两种情况为不相交，剩下四种情况为相交，代码中就是这个思路。\u003C\u002Fp\u003E\u003Cp\u003E\u003Cb\u003E第二\u003C\u002Fb\u003E，讨论光线起点在B中，显而易见，交点就是A的边界\u003C\u002Fp\u003E\u003Cp\u003E\u003Cb\u003E第三\u003C\u002Fb\u003E，讨论光线起点在A中，显而易见，交点就是B的边界\u003C\u002Fp\u003E\u003Cp\u003E\u003Cb\u003E第四\u003C\u002Fb\u003E，讨论光线起点在A交B中，这里必相交\u003C\u002Fp\u003E\u003Chr\u003E\u003Cp\u003E\u003Cb\u003E差：\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cdiv class=\&quot;highlight\&quot;\u003E\u003Cpre\u003E\u003Ccode class=\&quot;language-cpp\&quot;\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\&quot;k\&quot;\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Eop\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Et_subtract\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\&quot;p\&quot;\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;k\&quot;\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\&quot;k\&quot;\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Eobj1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;o\&quot;\u003E-&amp;gt;\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Esample\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Eori\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Edst\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;k\&quot;\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\&quot;k\&quot;\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Eobj2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;o\&quot;\u003E-&amp;gt;\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Esample\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Eori\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Edst\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;k\&quot;\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\&quot;k\&quot;\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Erd\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E((\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Ebody\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E?\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mi\&quot;\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mi\&quot;\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E&amp;lt;&amp;lt;\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mi\&quot;\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E|\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Ebody\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E?\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mi\&quot;\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mi\&quot;\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E);\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;k\&quot;\u003Eswitch\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Erd\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;p\&quot;\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;k\&quot;\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mi\&quot;\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\&quot;o\&quot;\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F not(A or B)\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;k\&quot;\u003Ebreak\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;k\&quot;\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mi\&quot;\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;o\&quot;\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F B\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;k\&quot;\u003Ebreak\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;k\&quot;\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mi\&quot;\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;o\&quot;\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F A\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;k\&quot;\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;k\&quot;\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\&quot;mi\&quot;\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\&quot;o\&quot;\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\&quot;c1\&quot;\u003E\u002F\u002F A and B\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;k\&quot;\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Einside\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;p\&quot;\u003E{\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;k\&quot;\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance2\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E&amp;gt;\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;p\&quot;\u003E{\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;k\&quot;\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E);\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;n\&quot;\u003Er\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Ebody\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Ebody\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;n\&quot;\u003Er\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Einside\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;nb\&quot;\u003Efalse\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;n\&quot;\u003Er\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;k\&quot;\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;p\&quot;\u003E}\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;k\&quot;\u003Ebreak\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;p\&quot;\u003E}\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;k\&quot;\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Einside\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;p\&quot;\u003E{\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;k\&quot;\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;p\&quot;\u003E}\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;k\&quot;\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E&amp;lt;\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;p\&quot;\u003E{\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;k\&quot;\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance2\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E&amp;lt;\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E)\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;p\&quot;\u003E{\u003C\u002Fspan\u003E\n                \u003Cspan class=\&quot;k\&quot;\u003Ebreak\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;p\&quot;\u003E}\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;k\&quot;\u003Eauto\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Er2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E);\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;n\&quot;\u003Er\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Ebody\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Ebody\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;n\&quot;\u003Er\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Einside\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;nb\&quot;\u003Efalse\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;n\&quot;\u003Er\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance\u003C\u002Fspan\u003E \u003Cspan class=\&quot;o\&quot;\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\&quot;n\&quot;\u003Edistance2\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n            \u003Cspan class=\&quot;k\&quot;\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;p\&quot;\u003E}\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;k\&quot;\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\&quot;n\&quot;\u003Er1\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;k\&quot;\u003Edefault\u003C\u002Fspan\u003E\u003Cspan class=\&quot;o\&quot;\u003E:\u003C\u002Fspan\u003E\n        \u003Cspan class=\&quot;k\&quot;\u003Ebreak\u003C\u002Fspan\u003E\u003Cspan class=\&quot;p\&quot;\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\&quot;p\&quot;\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\&quot;p\&quot;\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E差的实现也不简单，讨论射线与两圆的相交情况：\u003C\u002Fp\u003E\u003Cp\u003E\u003Cb\u003E第一\u003C\u002Fb\u003E：射线与两圆都不相交，那射线与A-B也不相交\u003C\u002Fp\u003E\u003Cp\u003E\u003Cb\u003E第二\u003C\u002Fb\u003E：射线与B相交，与A不相交，那射线与A-B也不相交\u003C\u002Fp\u003E\u003Cp\u003E\u003Cb\u003E第三\u003C\u002Fb\u003E：射线与A相交，与B不相交，射线必定与A-B相交\u003C\u002Fp\u003E\u003Cp\u003E\u003Cb\u003E第四\u003C\u002Fb\u003E：射线与A交B相交，这时情况复杂了\u003C\u002Fp\u003E\u003Cp\u003E\u003Cbr\u003E\u003C\u002Fp\u003E\u003Cfigure\u003E\u003Cnoscript\u003E\u003Cimg src=\&quot;https:\u002F\u002Fpic3.zhimg.com\u002Fv2-ee1d94d97a1d47334211b10db554f916_b.jpg\&quot; data-size=\&quot;normal\&quot; data-rawwidth=\&quot;818\&quot; data-rawheight=\&quot;490\&quot; class=\&quot;origin_image zh-lightbox-thumb\&quot; width=\&quot;818\&quot; data-original=\&quot;https:\u002F\u002Fpic3.zhimg.com\u002Fv2-ee1d94d97a1d47334211b10db554f916_r.jpg\&quot;\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\&quot;data:image\u002Fsvg+xml;utf8,&amp;lt;svg%20xmlns=&#x27;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#x27;%20width=&#x27;818&#x27;%20height=&#x27;490&#x27;&amp;gt;&amp;lt;\u002Fsvg&amp;gt;\&quot; data-size=\&quot;normal\&quot; data-rawwidth=\&quot;818\&quot; data-rawheight=\&quot;490\&quot; class=\&quot;origin_image zh-lightbox-thumb lazy\&quot; width=\&quot;818\&quot; data-original=\&quot;https:\u002F\u002Fpic3.zhimg.com\u002Fv2-ee1d94d97a1d47334211b10db554f916_r.jpg\&quot; data-actualsrc=\&quot;https:\u002F\u002Fpic3.zhimg.com\u002Fv2-ee1d94d97a1d47334211b10db554f916_b.jpg\&quot;\u003E\u003Cfigcaption\u003E差集的情况\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E只考虑两种不相交的情况，如图。反映在代码中就是两个break。\u003Cbr\u003E\u003C\u002Fp\u003E\u003Ch2\u003E小结\u003C\u002Fh2\u003E\u003Cp\u003E渲染的结果有所不同，发光图形本身的颜色是白色的，这是因为定义时的颜色是RGB(2.0f,1.0f,1.0f)，最终采样经平均后呈现时还是RGB(2.0f,1.0f,1.0f)，做了一个截断之后就是RGB(1.0f,1.0f,1.0f)即白色。\u003C\u002Fp\u003E\u003Cp\u003E本文重点即两圆之间的交集、差集的解析法实现，还有直线与圆的相交算法。\u003C\u002Fp\u003E\u003Cp\u003E程序下载：\u003Ca href=\&quot;https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fgithub.com\u002Fbajdcc\u002FGameFramework\u002Freleases\u002Ftag\u002Fv0.2.1\&quot; class=\&quot; wrap external\&quot; target=\&quot;_blank\&quot; rel=\&quot;nofollow noreferrer\&quot;\u003Ebajdcc\u002FGameFramework\u003Ci class=\&quot;icon-external\&quot;\u003E\u003C\u002Fi\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E&quot;,&quot;updated&quot;:new Date(&quot;2017-12-19T06:10:58.000Z&quot;),&quot;canComment&quot;:false,&quot;commentPermission&quot;:&quot;anyone&quot;,&quot;commentCount&quot;:5,&quot;collapsedCount&quot;:0,&quot;likeCount&quot;:87,&quot;state&quot;:&quot;published&quot;,&quot;isLiked&quot;:false,&quot;slug&quot;:&quot;32150887&quot;,&quot;isTitleImageFullScreen&quot;:true,&quot;rating&quot;:&quot;none&quot;,&quot;titleImage&quot;:&quot;https:\u002F\u002Fpic4.zhimg.com\u002Fv2-3d70b56d3d5813599b11200f0d877007_r.jpg&quot;,&quot;links&quot;:{&quot;comments&quot;:&quot;\u002Fapi\u002Fposts\u002F32150887\u002Fcomments&quot;},&quot;reviewers&quot;:[],&quot;topics&quot;:[{&quot;url&quot;:&quot;https:\u002F\u002Fwww.zhihu.com\u002Ftopic\u002F19613730&quot;,&quot;id&quot;:&quot;19613730&quot;,&quot;name&quot;:&quot;计算机图形学&quot;},{&quot;url&quot;:&quot;https:\u002F\u002Fwww.zhihu.com\u002Ftopic\u002F19601705&quot;,&quot;id&quot;:&quot;19601705&quot;,&quot;name&quot;:&quot;C \u002F C++&quot;},{&quot;url&quot;:&quot;https:\u002F\u002Fwww.zhihu.com\u002Ftopic\u002F19554298&quot;,&quot;id&quot;:&quot;19554298&quot;,&quot;name&quot;:&quot;编程&quot;}],&quot;adminClosedComment&quot;:false,&quot;titleImageSize&quot;:{&quot;width&quot;:1366,&quot;height&quot;:728},&quot;href&quot;:&quot;\u002Fapi\u002Fposts\u002F32150887&quot;,&quot;excerptTitle&quot;:&quot;&quot;,&quot;tipjarState&quot;:&quot;inactivated&quot;,&quot;annotationAction&quot;:[],&quot;sourceUrl&quot;:&quot;&quot;,&quot;pageCommentsCount&quot;:5,&quot;hasPublishingDraft&quot;:false,&quot;snapshotUrl&quot;:&quot;&quot;,&quot;publishedTime&quot;:&quot;2017-12-19T14:10:58+08:00&quot;,&quot;url&quot;:&quot;\u002Fp\u002F32150887&quot;,&quot;lastestLikers&quot;:[{&quot;bio&quot;:null,&quot;isFollowing&quot;:false,&quot;hash&quot;:&quot;cfae31b85eadc0b8c278303332b4e1a0&quot;,&quot;uid&quot;:628849659410649100,&quot;isOrg&quot;:false,&quot;slug&quot;:&quot;llllllscc&quot;,&quot;isFollowed&quot;:false,&quot;description&quot;:&quot;&quot;,&quot;name&quot;:&quot;HtrhTrhtR&quot;,&quot;profileUrl&quot;:&quot;https:\u002F\u002Fwww.zhihu.com\u002Fpeople\u002Fllllllscc&quot;,&quot;avatar&quot;:{&quot;id&quot;:&quot;v2-b81cbfbac8d691b84dba1a95bb8627ca&quot;,&quot;template&quot;:&quot;https:\u002F\u002Fpic1.zhimg.com\u002F{id}_{size}.jpg&quot;},&quot;isOrgWhiteList&quot;:false,&quot;isBanned&quot;:false},{&quot;bio&quot;:&quot;&quot;,&quot;isFollowing&quot;:false,&quot;hash&quot;:&quot;4104fb8f19a881d809416d912c574665&quot;,&quot;uid&quot;:54218194944000,&quot;isOrg&quot;:false,&quot;slug&quot;:&quot;ceng-yan-30&quot;,&quot;isFollowed&quot;:false,&quot;description&quot;:&quot;&quot;,&quot;name&quot;:&quot;DTer&quot;,&quot;profileUrl&quot;:&quot;https:\u002F\u002Fwww.zhihu.com\u002Fpeople\u002Fceng-yan-30&quot;,&quot;avatar&quot;:{&quot;id&quot;:&quot;80664c6e4978d53b8d92ea9b26f70d10&quot;,&quot;template&quot;:&quot;https:\u002F\u002Fpic4.zhimg.com\u002F{id}_{size}.jpg&quot;},&quot;isOrgWhiteList&quot;:false,&quot;isBanned&quot;:false},{&quot;bio&quot;:&quot;好想钻进被窝里&quot;,&quot;isFollowing&quot;:false,&quot;hash&quot;:&quot;da5c3dab825b9b190b45d8559c5be96e&quot;,&quot;uid&quot;:819577431341039600,&quot;isOrg&quot;:false,&quot;slug&quot;:&quot;aiyu-98&quot;,&quot;isFollowed&quot;:false,&quot;description&quot;:&quot;&quot;,&quot;name&quot;:&quot;加鲁鲁&quot;,&quot;profileUrl&quot;:&quot;https:\u002F\u002Fwww.zhihu.com\u002Fpeople\u002Faiyu-98&quot;,&quot;avatar&quot;:{&quot;id&quot;:&quot;v2-9a50b0f90763ec6c56a9e7eb850b1a3d&quot;,&quot;template&quot;:&quot;https:\u002F\u002Fpic3.zhimg.com\u002F{id}_{size}.jpg&quot;},&quot;isOrgWhiteList&quot;:false,&quot;isBanned&quot;:false},{&quot;bio&quot;:&quot;大学生＼爱看anime＼Python学习中＼其它都不会.jpg&quot;,&quot;isFollowing&quot;:false,&quot;hash&quot;:&quot;5bcd5bcff58b4eec7c9df03f1aa5fc65&quot;,&quot;uid&quot;:823634862350151700,&quot;isOrg&quot;:false,&quot;slug&quot;:&quot;lgh-6-29&quot;,&quot;isFollowed&quot;:false,&quot;description&quot;:&quot;我是b乎最弱的玩家&quot;,&quot;name&quot;:&quot;LGH&quot;,&quot;profileUrl&quot;:&quot;https:\u002F\u002Fwww.zhihu.com\u002Fpeople\u002Flgh-6-29&quot;,&quot;avatar&quot;:{&quot;id&quot;:&quot;v2-51e9fc1f14c1e9c0ef1addcc7942a082&quot;,&quot;template&quot;:&quot;https:\u002F\u002Fpic1.zhimg.com\u002F{id}_{size}.jpg&quot;},&quot;isOrgWhiteList&quot;:false,&quot;isBanned&quot;:false},{&quot;bio&quot;:&quot;程序猿要学习&quot;,&quot;isFollowing&quot;:false,&quot;hash&quot;:&quot;1a3d518171357b084b886bb41885f438&quot;,&quot;uid&quot;:574169042751852540,&quot;isOrg&quot;:false,&quot;slug&quot;:&quot;jin-tao-49-39&quot;,&quot;isFollowed&quot;:false,&quot;description&quot;:&quot;来到魔都的研究生~&quot;,&quot;name&quot;:&quot;半城烟沙king&quot;,&quot;profileUrl&quot;:&quot;https:\u002F\u002Fwww.zhihu.com\u002Fpeople\u002Fjin-tao-49-39&quot;,&quot;avatar&quot;:{&quot;id&quot;:&quot;v2-6404fa0a5980247a4a7378c68c827fa7&quot;,&quot;template&quot;:&quot;https:\u002F\u002Fpic3.zhimg.com\u002F{id}_{size}.jpg&quot;},&quot;isOrgWhiteList&quot;:false,&quot;isBanned&quot;:false}],&quot;summary&quot;:&quot;\u003Cimg src=\&quot;http:\u002F\u002Fpic3.zhimg.com\u002Fv2-a8e39207779b638b88597e5aa825fa46_200x112.jpg\&quot; data-caption=\&quot;交集的情况\&quot; data-size=\&quot;normal\&quot; data-rawwidth=\&quot;962\&quot; data-rawheight=\&quot;508\&quot; class=\&quot;origin_image inline-img zh-lightbox-thumb\&quot; data-original=\&quot;http:\u002F\u002Fpic3.zhimg.com\u002Fv2-a8e39207779b638b88597e5aa825fa46_r.jpg\&quot;\u003E(视频：1080P四线程渲染，CPU i7-7700，两图用时约30秒，视频大小0.6M)写在前面在先前的画光系列中，实现实体几何、反射、折射等效果，但是最大的一个缺陷是复杂度太高。当采样是1024时，渲染时间直线上升（用4线程），以至好几个小时才能完成一副作品，实…&quot;,&quot;reviewingCommentsCount&quot;:0,&quot;meta&quot;:{&quot;previous&quot;:null,&quot;next&quot;:null},&quot;annotationDetail&quot;:null,&quot;commentsCount&quot;:5,&quot;likesCount&quot;:87,&quot;FULLINFO&quot;:true}},&quot;User&quot;:{&quot;bajdcc&quot;:{&quot;isFollowed&quot;:false,&quot;name&quot;:&quot;陈安&quot;,&quot;headline&quot;:&quot;发现编程的乐趣 https:\u002F\u002Fgithub.com\u002Fbajdcc&quot;,&quot;avatarUrl&quot;:&quot;https:\u002F\u002Fpic1.zhimg.com\u002Fv2-cd6d61ad9ef94c41b9e77f8e0f727893_s.jpg&quot;,&quot;isFollowing&quot;:false,&quot;type&quot;:&quot;people&quot;,&quot;slug&quot;:&quot;bajdcc&quot;,&quot;bio&quot;:&quot;专业研究野生技术&quot;,&quot;hash&quot;:&quot;7a228f3d98a5d011f952110c10dc4976&quot;,&quot;uid&quot;:71809588264960,&quot;isOrg&quot;:false,&quot;description&quot;:&quot;发现编程的乐趣 https:\u002F\u002Fgithub.com\u002Fbajdcc&quot;,&quot;badge&quot;:{&quot;identity&quot;:null,&quot;bestAnswerer&quot;:null},&quot;profileUrl&quot;:&quot;https:\u002F\u002Fwww.zhihu.com\u002Fpeople\u002Fbajdcc&quot;,&quot;avatar&quot;:{&quot;id&quot;:&quot;v2-cd6d61ad9ef94c41b9e77f8e0f727893&quot;,&quot;template&quot;:&quot;https:\u002F\u002Fpic1.zhimg.com\u002F{id}_{size}.jpg&quot;},&quot;isOrgWhiteList&quot;:false,&quot;isBanned&quot;:false}},&quot;Comment&quot;:{},&quot;favlists&quot;:{}},&quot;me&quot;:{},&quot;global&quot;:{&quot;experimentFeatures&quot;:{&quot;ge3&quot;:&quot;ge3_9&quot;,&quot;ge2&quot;:&quot;ge2_1&quot;,&quot;nwebStickySidebar&quot;:&quot;sticky&quot;,&quot;searchSectionStyle&quot;:&quot;loosen&quot;,&quot;androidPassThroughPush&quot;:&quot;leancloud&quot;,&quot;newMore&quot;:&quot;new&quot;,&quot;nwebQAGrowth&quot;:&quot;experiment&quot;,&quot;nwebFeedAd&quot;:&quot;experiment&quot;,&quot;newSign&quot;:&quot;newVersion&quot;,&quot;liveReviewBuyBar&quot;:&quot;live_review_buy_bar_2&quot;,&quot;qawebRelatedReadingsContentControl&quot;:&quot;open&quot;,&quot;marketTabBanner&quot;:&quot;market_tab_banner_not_show&quot;,&quot;liveStore&quot;:&quot;ls_a2_b2_c1_f2&quot;,&quot;qawebThumbnailAbtest&quot;:&quot;new&quot;,&quot;nwebSearch&quot;:&quot;nweb_search_heifetz&quot;,&quot;searchHybridTabs&quot;:&quot;without-tabs&quot;,&quot;enableVoteDownReasonMenu&quot;:&quot;enable&quot;,&quot;showVideoUploadAttention&quot;:&quot;true&quot;,&quot;isOffice&quot;:&quot;false&quot;,&quot;enableTtsPlay&quot;:&quot;false&quot;,&quot;wechatShareModal&quot;:&quot;wechat_share_modal_show&quot;,&quot;newLiveFeedMediacard&quot;:&quot;old&quot;,&quot;hybridZhmoreVideo&quot;:&quot;no&quot;,&quot;recommendationAbtest&quot;:&quot;new&quot;,&quot;qrcodeLogin&quot;:&quot;qrcode&quot;,&quot;isShowUnicomFreeEntry&quot;:&quot;unicom_free_entry_off&quot;,&quot;newMobileColumnAppheader&quot;:&quot;new_header&quot;,&quot;androidDbCommentWithRepinRecord&quot;:&quot;open&quot;,&quot;androidDbRecommendAction&quot;:&quot;open&quot;,&quot;zcmLighting&quot;:&quot;zcm&quot;,&quot;androidDbFeedHashTagStyle&quot;:&quot;button&quot;,&quot;appStoreRateDialog&quot;:&quot;close&quot;,&quot;mobileQaPageProxyHeifetz&quot;:&quot;m_qa_page_nweb&quot;,&quot;newAppViewRelatedAd&quot;:&quot;no&quot;,&quot;default&quot;:&quot;None&quot;,&quot;isNewNotiPanel&quot;:&quot;yes&quot;,&quot;androidDbRepinSelection&quot;:&quot;open&quot;,&quot;nwebRelatedAdvert&quot;:&quot;default&quot;,&quot;qaStickySidebar&quot;:&quot;sticky_sidebar&quot;,&quot;androidProfilePanel&quot;:&quot;panel_b&quot;,&quot;nwebWriteAnswer&quot;:&quot;experiment&quot;}},&quot;columns&quot;:{&quot;next&quot;:{}},&quot;columnPosts&quot;:{},&quot;columnSettings&quot;:{&quot;colomnAuthor&quot;:[],&quot;uploadAvatarDetails&quot;:&quot;&quot;,&quot;contributeRequests&quot;:[],&quot;contributeRequestsTotalCount&quot;:0,&quot;inviteAuthor&quot;:&quot;&quot;},&quot;postComments&quot;:{},&quot;postReviewComments&quot;:{&quot;comments&quot;:[],&quot;newComments&quot;:[],&quot;hasMore&quot;:true},&quot;favlistsByUser&quot;:{},&quot;favlistRelations&quot;:{},&quot;promotions&quot;:{},&quot;switches&quot;:{&quot;couldSetPoster&quot;:false},&quot;draft&quot;:{&quot;titleImage&quot;:&quot;&quot;,&quot;titleImageSize&quot;:{},&quot;isTitleImageFullScreen&quot;:false,&quot;canTitleImageFullScreen&quot;:false,&quot;title&quot;:&quot;&quot;,&quot;titleImageUploading&quot;:false,&quot;error&quot;:&quot;&quot;,&quot;content&quot;:&quot;&quot;,&quot;draftLoading&quot;:false,&quot;globalLoading&quot;:false,&quot;pendingVideo&quot;:{&quot;resource&quot;:null,&quot;error&quot;:null}},&quot;drafts&quot;:{&quot;draftsList&quot;:[],&quot;next&quot;:{}},&quot;config&quot;:{&quot;userNotBindPhoneTipString&quot;:{}},&quot;recommendPosts&quot;:{&quot;articleRecommendations&quot;:[],&quot;columnRecommendations&quot;:[]},&quot;env&quot;:{&quot;edition&quot;:{&quot;baidu&quot;:false,&quot;yidianzixun&quot;:false,&quot;qqnews&quot;:false},&quot;isAppView&quot;:false,&quot;appViewConfig&quot;:{&quot;content_padding_top&quot;:128,&quot;content_padding_bottom&quot;:56,&quot;content_padding_left&quot;:16,&quot;content_padding_right&quot;:16,&quot;title_font_size&quot;:22,&quot;body_font_size&quot;:16,&quot;is_dark_theme&quot;:false,&quot;can_auto_load_image&quot;:true,&quot;app_info&quot;:&quot;OS=iOS&quot;},&quot;isApp&quot;:false,&quot;userAgent&quot;:{&quot;ua&quot;:&quot;Wget\u002F1.19.1 (cygwin)&quot;,&quot;browser&quot;:{},&quot;engine&quot;:{},&quot;os&quot;:{},&quot;device&quot;:{},&quot;cpu&quot;:{}}},&quot;message&quot;:{&quot;newCount&quot;:0},&quot;pushNotification&quot;:{&quot;newCount&quot;:0}}</textarea><script src="//static.zhihu.com/hemingway/common.dbe216922984b85d39c4.js"></script><script src="//static.zhihu.com/hemingway/app.eecd17b317c2f4ce2f56.js"></script><script src="//static.zhihu.com/hemingway/raven.bdd8772ab8ba1205b8ea.js" async="" defer=""></script></body></html>